<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>使用Comsol进行多体动力学仿真</title>
      <link href="2021/01/10/comsol-tutorials/"/>
      <url>2021/01/10/comsol-tutorials/</url>
      
        <content type="html"><![CDATA[<blockquote><p>使用 Comsol 进行多体动力学仿真及简单的结果分析。</p></blockquote><a id="more"></a><h2 id="§-Comsol仿真操作步骤"><a href="#§-Comsol仿真操作步骤" class="headerlink" title="§ Comsol仿真操作步骤"></a>§ Comsol仿真操作步骤</h2><h3 id="1-新建模型"><a href="#1-新建模型" class="headerlink" title="1 新建模型"></a>1 新建模型</h3><p>打开 <strong>Comsol</strong> $\Rightarrow$ 模型向导 $\Rightarrow$<br>三维 $\Rightarrow$ <strong>结构力学/多体动力学</strong> $\Rightarrow$<br>添加+研究 $\Rightarrow$ 瞬态 $\Rightarrow$ 完成。</p><h3 id="2-建立几何模型"><a href="#2-建立几何模型" class="headerlink" title="2 建立几何模型"></a>2 建立几何模型</h3><p>在 <strong>组件1/几何</strong> 中建立几何模型。<br>复杂的模型需要从外部导入，同时模型可以导出保存。<br>Comsol 中可以建立简单几何体，下面介绍圆柱和空心圆柱的构建步骤。</p><h4 id="2-1-圆柱"><a href="#2-1-圆柱" class="headerlink" title="2.1 圆柱"></a>2.1 圆柱</h4><ol><li>单击 <strong>几何</strong> 修改长度单位 <code>mm</code> , 角度单位 <code>rad</code>。</li><li>右键 <strong>几何</strong> 选择<code>圆柱体</code>。进入圆柱体设置分栏。</li><li>设置<strong>轴类型</strong> ( 即轴的方向 )。 选择<code>y轴</code>。</li><li><strong>大小和形状</strong>。 半径<code>40</code>, 高度<code>2</code>。</li><li><strong>位置</strong>。<code>[x,y,z]=[0,2,0]</code>。</li><li>点击<strong>构建所有对象</strong>。在图形界面出现构建的圆盘, 如下图所示。</li></ol><p><img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/shape_para.png"height = "250" alt="圆盘参数" align=center /><br><img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/cylinder.png"height = "250" alt="圆盘" align=center /></p><h4 id="2-2-空心圆柱"><a href="#2-2-空心圆柱" class="headerlink" title="2.2 空心圆柱"></a>2.2 空心圆柱</h4><ol><li>重复构建圆柱的步骤构建两个圆柱。</li></ol><p><strong>大小和形状</strong> 分别为<code>[10,2], [4,2]</code>；<br><strong>位置</strong> 均为<code>[10,0,0]</code>；<br><strong>轴类型</strong> 均为 <code>y轴</code>。</p><ol><li>构建<strong>差集</strong>。右键 <strong>几何1</strong> ，依次选择 <code>布尔操作与分割</code> – <code>差集</code>。</li><li>进入<strong>差集</strong> 设置栏。<br><code>要添加的对象</code> 较大的圆柱，<code>要减去的对象</code> 选择较小的圆柱。</li><li>点击<strong>构建所有对象</strong>。在图形界面出现构建的圆盘, 如下图所示。</li></ol><p><img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/cylinder_ring.png"height = "250" alt="空心圆柱" align=center /></p><p>本次仿真实验最终构建的几何模型如下所示：</p><p><img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/bicylinder.png" height = "250" alt="" align=center /></p><h4 id="2-3-创建接触对"><a href="#2-3-创建接触对" class="headerlink" title="2.3 创建接触对"></a>2.3 创建接触对</h4><ol><li>方法1: 在 <strong>几何1</strong> 下选择 <strong>形成装配</strong>，</li></ol><p><strong>动作</strong> 选为 <code>装配</code>，勾选 <code>创建对</code>，<strong>对类型</strong> 选择<code>接触对</code>。<br>点击<strong>全部构建</strong>。在<strong>组件1/定义</strong> 下会出现几何模型中重合的面构成的接触对。</p><ol><li>方法2: 右键 <strong>组件1/定义</strong> ，依次选择 <code>对/接触对</code>。<br>然后选择 <strong>源边界</strong> 和 <strong>目标边界</strong> 分别为接触的两个面。</li></ol><p><strong>Remark:</strong> </p><ol><li>形成装配会生成接触对。<br>表示接触表面分别属于两个不同物体，二者接触间不存在剪切力等分子间作用力。<br>形成联合体生成一致对。<br>表示接触的几何模型同属于一个实体。</li></ol><h4 id="2-4-添加材料"><a href="#2-4-添加材料" class="headerlink" title="2.4 添加材料"></a>2.4 添加材料</h4><ol><li>右键 <strong>组件1/材料</strong> ，从库中添加材料，<br>选择需要的材料，如 <code>iron</code>，自动应用到所有域。</li></ol><h3 id="3-物理场设置"><a href="#3-物理场设置" class="headerlink" title="3 物理场设置"></a>3 物理场设置</h3><h4 id="3-1-连接件"><a href="#3-1-连接件" class="headerlink" title="3.1 连接件"></a>3.1 连接件</h4><p>连接件是几何实体中连接关节的虚拟部件。<br>对几何体附加刚性域或其他属性后并不能直接用来定义运动关节，<br>需要先定义连接件。</p><ol><li>右键 <strong>多体动力学</strong> 选择<code>连接件</code> 建立连接件1 。选择左圆盘所有表面。<br>同理建立右圆盘的连接件2。</li></ol><h4 id="3-2-定义运动副"><a href="#3-2-定义运动副" class="headerlink" title="3.2 定义运动副"></a>3.2 定义运动副</h4><p>双转盘模型可以理解为一边圆盘为转动关节 (铰链关节)，只有一个转动自由度；<br>另一个圆盘为圆柱副，有一个绕轴线的转动自由度和沿轴线的平动自由度，<br>其中平动自由度用来控制加持力。</p><ol><li>建立 <strong>圆柱副</strong> 。<br>右键 <strong>多体动力学</strong> 依次选择 <code>关节/圆柱副</code>。<br>选择 <strong>源</strong> 为 <code>固定</code>, 目标为 <code>连接件1</code>， <strong>关节中心</strong> 选择 <code>目标质心</code>。</li></ol><p><strong>关节轴</strong> 选择 <code>指定方向</code>，并设置为y轴方向 <code>[0,1,0]</code>。</p><ol><li>建立 <strong>铰链关节</strong>。<br>右键 <strong>多体动力学</strong> 依次选择 <code>关节/铰链关节</code>。<br>选择 <strong>源</strong> 为 <code>固定</code>, 目标为 <code>连接件2</code>， <strong>关节中心</strong> 选择 <code>目标质心</code>。</li></ol><p><strong>关节轴</strong> 选择 <code>指定方向</code>，并设置为y轴方向 <code>[0,1,0]</code>。</p><ol><li>为圆柱副设置转速与关节作用力。<br>右键 <strong>圆柱副1</strong> ，选择 <code>指定运动</code>。</li></ol><p><strong>指定旋转运动</strong> 中选择 指定穿越运动为 <code>角速度</code>, 设置为 <code>30rad/s</code>。<br>右键 <strong>圆柱副1</strong> ，选择 <code>作用力和力矩</code>。<br><strong>作用于</strong> <code>目标连接件</code>， <strong>位置</strong> 为<code>连接件中心</code>，<br>设置作用力为<code>[0,1,0] N</code>。</p><ol><li>为铰链关节设置转速。<br>右键 <strong>铰链关节1</strong> ，选择 <code>指定运动</code>。</li></ol><p><strong>指定旋转运动</strong> 中选择 指定穿越运动为 <code>角速度</code>, 设置为 <code>-30rad/s</code>。</p><h4 id="3-3-物理场中的接触对"><a href="#3-3-物理场中的接触对" class="headerlink" title="3.3 物理场中的接触对"></a>3.3 物理场中的接触对</h4><p>物理场中的接触对用于模拟实际物体之间接触发生的动力学模型，<br>没有添加接触对的实体在仿真中不会发生碰撞和干涉。<br>圆盘和物体之间的正压力和摩擦力等需要通过设置接触对来实现，<br>设置步骤如下。</p><ol><li><p>右键 <strong>多体动力学</strong> 选择<code>对/摩擦</code> 以添加接触对。</p></li><li><p>进入 <strong>接触</strong> 设置界面，<strong>对选择</strong> 选择几何模型中设置的<code>接触对1</code>。</p></li><li><p>添加摩擦特征，右键 <strong>接触1</strong> 选择 <code>摩擦</code>。<br>进入摩擦设置界面，设置摩擦模型。</p></li><li><p>重复上述操作，建立并设置 <code>接触2</code>。</p></li></ol><p>本实验的摩擦参数选择为：</p><p><img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/friction.png"height = "250" alt="摩擦参数" align=center /></p><h4 id="3-4-添加力场"><a href="#3-4-添加力场" class="headerlink" title="3.4 添加力场"></a>3.4 添加力场</h4><p>为被控物体添加重力。</p><ol><li>右键 <strong>多体动力学</strong> 选择 <code>体积力/重力</code>。<br>在重力设置界面，<strong>域选择</strong> 选择为被控物体。</li></ol><h4 id="3-5-划分网格"><a href="#3-5-划分网格" class="headerlink" title="3.5 划分网格"></a>3.5 划分网格</h4><p>选择自动划分网格。<br>在 <strong>多提动力学/网格1</strong> 中选择物理场控制网格，并选择单元大小。<br>点击全部构建即可，<code>超细化</code> 网格生成后如下图所示。</p><p><img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/meshing.png"height = "250" alt="划分网格" align=center /></p><p><strong>Remark:</strong> </p><ol><li><p>运行的结果可能会影响之后修改后的模型的仿真 (不确定)。<br>如果仿真报错，而模型设置没有问题时可以考虑创建新的仿真文件。</p></li><li><p>添加物理时，最好每添加一个运行一次仿真，以确保设置无误。</p></li></ol><h3 id="4-模型的仿真及结果分析"><a href="#4-模型的仿真及结果分析" class="headerlink" title="4 模型的仿真及结果分析"></a>4 模型的仿真及结果分析</h3><h4 id="4-1-模型仿真"><a href="#4-1-模型仿真" class="headerlink" title="4.1 模型仿真"></a>4.1 模型仿真</h4><ol><li>展开 <strong>研究1/步骤1: 瞬态</strong>，设置仿真器时间步。</li><li>点击 <strong>瞬态</strong> 设置栏中的计算，开始仿真。</li></ol><p>本次实验的时间步设置如下，实验平均用时25mins。</p><p><img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/solver_setting.png"height = "250" alt="仿真器设置" align=center /></p><h4 id="4-2-仿真效果的查看"><a href="#4-2-仿真效果的查看" class="headerlink" title="4.2 仿真效果的查看"></a>4.2 仿真效果的查看</h4><p>仿真结束后, 在结果栏中出现新的子菜单, 如图所示。<br>在 <strong>位移</strong> 和 <strong>速度</strong> 栏中可以查看每个时间步下的物理场和速度场。<br>位移场也展示在下面。</p><p><img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/result_menu.png"height = "250" alt="结果菜单" align=center /><br><img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/motion.png" height = "250" alt="位移场" align=center /></p><h4 id="4-3-导出动画"><a href="#4-3-导出动画" class="headerlink" title="4.3 导出动画"></a>4.3 导出动画</h4><p>以导出位移场的动画为例。</p><ol><li><p>选择 <strong>结果/位移(mbd)**，菜单栏中出现新的操作按钮(如下图)。<br>右下角的按钮即为 **动画</strong>。</p></li><li><p>点击 <strong>动画/文件</strong> 。</p></li></ol><p><strong>输出类型</strong> 选择 <code>电影</code> ，<strong>格式</strong> 选择 <code>GIF</code> ，<br><strong>时间选择</strong> 选择 <code>来自列表</code> 后可以导出特定时间段的视频，也可以后期剪辑，<br><strong>布局</strong> 选项中勾选需要导出的额外信息。</p><ol><li>点击导出，选择保存路径和文件名即可。</li></ol><p><img src="https://gitee.com/lazyshawn/piclink/raw/master/comsol/animation.png"width = "450" alt="制作动画" align=center /></p><h4 id="4-4-导出指定点的物理信息"><a href="#4-4-导出指定点的物理信息" class="headerlink" title="4.4 导出指定点的物理信息"></a>4.4 导出指定点的物理信息</h4><ol><li>右键 <strong>结果/派生值</strong> 选择 <code>点计算</code>。<br>进入点计算设置栏，手动选择需要计算的点，<br>这里可选择的点根据模型的变化而有所不同。</li></ol><p><strong>表达式</strong> 添加需要导出的变量名称<br>(具体的查找方法待定, 可查看帮助手册$^{[1]}$)，<br><code>x, y, z, u, v, w</code> 分别为各个方向的位置和速度。<br>点击 <strong>计算</strong>, 会在消息栏 (界面右下角) 出现计算结果，<br>并生成 <strong>结果/表格/表格1</strong> 。</p><ol><li><p>进入 <strong>结果/表格/表格1</strong> 选择 <code>添加要导出的表</code> 。</p></li><li><p>右键 <strong>结果/导出/表格1</strong> 导出, 选择保存路径和文件名即可。</p></li></ol><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><ol><li><a href="http://cdn.comsol.com/translated-documentation/cn/5.0/%E5%90%8E%E5%A4%84%E7%90%86%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96%E7%BB%BC%E8%BF%B0.pdf">Comsol Multiphysics 后处理与可视化综述</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 术业专攻 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Comsol </tag>
            
            <tag> 多体动力学仿真 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于Matlab的二指夹具在手操作仿真（一）</title>
      <link href="2020/03/03/Sim-prehensile-pushing-using-matlab/"/>
      <url>2020/03/03/Sim-prehensile-pushing-using-matlab/</url>
      
        <content type="html"><![CDATA[<blockquote><p>二指夹具在重力作用下进行在手操作，通过控制二指夹具施加的加持力，让工具精确地下降指定距离。利用Matlab仿真验证控制方案的可行性。</p></blockquote><a id="more"></a><h2 id="模型的建立"><a href="#模型的建立" class="headerlink" title="模型的建立"></a>模型的建立</h2><p>本研究中的二指夹具仅有一个自由度，在手指位置具有半球形的软垫，可以用来加持工具。记工具顶端到夹具中心位置的竖直距离为$h(t)$，工具在任意时刻的状态$x(t)=[h(t), \dot h(t)]^T$可以由传感器测量得到。假设工具竖直下落，不会产生转动。故夹具的加持动作只产生一个摩擦力，而不会产生摩擦力矩。我们的控制目标是让工具从开始位置$h_0(t_0)$，按期望的路径$h_d(t)$竖直下落到指定位置$h_d(t_f)$<a href="#ref-anchor"><sup>[1]</sup></a>。运动过程如下图所示：<br><img src="http://q789z4z6g.bkt.clouddn.com/sim1.png?center" alt="运动过程示意图"></p><h3 id="滑动摩擦力模型"><a href="#滑动摩擦力模型" class="headerlink" title="滑动摩擦力模型"></a>滑动摩擦力模型</h3><p>考虑摩擦力由库伦摩擦力和黏滞摩擦力组成，即<br>$$f=-\mu sgn(\dot h)f_n - \sigma \dot h \tag{1}$$<br>式中$\mu$为库伦摩擦系数，$f_n$为手指施加给工具的正压力，$\dot h$为工具下落速度，$sgn(\cdot)$为符号函数，$\sigma$为黏滞摩擦系数。从式$(1)$中我们可以得到施加的正压力和摩擦力之间的关系。</p><h3 id="动力学模型"><a href="#动力学模型" class="headerlink" title="动力学模型"></a>动力学模型</h3><p>由牛顿第二定律可以得到该系统的动力学方程为：<br>$$ m\ddot h = -mg + f \tag{2}$$<br>将式$(1)$带入上式得到如下的动力学模型：<br>$$m\ddot h = -mg - \mu sgn(\dot h)f_n - \sigma \dot h \tag{3}$$</p><h2 id="自适应控制模型的设计"><a href="#自适应控制模型的设计" class="headerlink" title="自适应控制模型的设计"></a>自适应控制模型的设计</h2><p>为了推到自适应控制方程，我们将式$(3)$描述的动力学模型改写为以$u_{f_n}$为输入信号的形式：<br>$$ a\ddot{h} + b\dot{h} + cg = u_{f_n} \tag{4}$$<br>式中$a = c = m/\mu$，$b = \sigma/\mu$。然后定义如下的跟踪误差：<br>$$s = \dot{\tilde{h}} + \lambda\tilde{h} \tag{5}$$<br>式中$\dot{\tilde{h}}=\dot{h}-\dot{h}_d$，$\tilde{h} = h-h_d$分别为位置和速度误差，$\lambda$为一常数。</p><p>这样我们就能写出标准的自适应控制方程<a href="#ref-anchor"><sup>[2]</sup></a><br>$$u_{f_n} = \hat{a}\ddot{h}_r - ks + \hat{b}\dot{h} + \hat{c}g \tag{6}$$</p><p>该控制方程共由以下几部分组成：反馈加速度项$\hat{a}\ddot{h}_r$、跟踪误差项$ks$、速度误差项$\hat{b}\dot{h}$以及重力补偿项$\hat{c}g$。其中参考加速度$\ddot{h}_r = \ddot{h}_d - \lambda\dot{\tilde{h}}$，$k$是一个正的跟踪控制激励，$\hat{a}, \hat{b}, \hat{c}$分别为$a, b, c$的适应性估计值，根据下式进行调整：<br>$$\begin{array}{c}<br>\dot{\hat{a}} &amp;=&amp; -\alpha_a s\ddot{h}_r  \<br>\dot{\hat{b}} &amp;=&amp; -\alpha_b s\dot{h}     \<br>\dot{\hat{c}} &amp;=&amp; -\alpha_c sg \tag{7}<br>\end{array}$$<br>其中$\alpha_a, \alpha_b, \alpha_c$均为正的适应激励。值得注意的是式$(7)$给出的实时估计值并不能保证对应的参数收敛到真值，除非满足持续激励条件（persistent excitation conditions)。但这并不是我们考虑的问题，因为我们项目只需要保证工具的运动，而不是摩擦参数的估计值的准确性。这个控制方案也的确保证了跟踪误差$s$的收敛性，说明我们工具能准确运动到指定位置。</p><h2 id="验证控制模型"><a href="#验证控制模型" class="headerlink" title="验证控制模型"></a>验证控制模型</h2><p>由于我们的模型相对简单，只有一个自由度，外力只需要考虑垂直方向上的重力和摩擦力，所以可以很容易的通过编程来模拟运动过程，以此验证控制算法的准确性。同样用Matlab编程，程序如下：</p><pre class="line-numbers language-matlab"><code class="language-matlab"><span class="token comment" spellcheck="true">% 基于Matlab的二指夹具在手操作仿真</span><span class="token comment" spellcheck="true">% --- 符号规定 ---</span><span class="token comment" spellcheck="true">% t: 时间序列, tt: 时间间隔, h: 实际位置, hd: 目标位置, </span><span class="token comment" spellcheck="true">% hv: 位置误差, dhv: 速度误差, s: 跟踪误差,</span><span class="token comment" spellcheck="true">% miu: 库伦摩擦系数, sigma: 黏滞摩擦系数, g: 重力加速度, </span><span class="token comment" spellcheck="true">% fn: 正压力, f:总摩擦力,</span><span class="token comment" spellcheck="true">% lamb: 控制常量, k: 跟踪控制激励, </span><span class="token comment" spellcheck="true">% alpha_a, alpha_b, alpha_c: 控制方程调参系数,</span><span class="token comment" spellcheck="true">% ae, be, ce: 控制方程系数的估计值,</span>clear<span class="token punctuation">;</span>  clc<span class="token punctuation">;</span><span class="token comment" spellcheck="true">% --- 控制参数调整</span>lamb <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>k <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>alpha_a <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>alpha_b <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>alpha_c <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token function">ae</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token function">be</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token function">ce</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">% --- 模型常量估计值</span>g <span class="token operator">=</span> <span class="token number">9.8</span><span class="token punctuation">;</span>miu <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>sigma <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>m <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">% --- 系统初值及参考模型</span>tt <span class="token operator">=</span> <span class="token number">0.01</span><span class="token punctuation">;</span>t <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">:</span> tt<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">;</span>N <span class="token operator">=</span> <span class="token function">length</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>h0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>hd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">*</span><span class="token function">ones</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">% --- 循环变量初始化</span>h <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>dh <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ddh <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span>N<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">% For begining</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> h0<span class="token punctuation">;</span><span class="token function">dh</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token function">ddh</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token function">dhv</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">% Loop begin</span><span class="token keyword">for</span> <span class="token number">i</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">:</span>N    <span class="token function">h</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span>  <span class="token function">h</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">dh</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>tt <span class="token operator">+</span> <span class="token number">1</span><span class="token operator">/</span><span class="token number">2</span><span class="token operator">*</span><span class="token function">ddh</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>tt<span class="token operator">*</span>tt<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token function">h</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token function">h</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">end</span>    <span class="token function">dh</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>tt<span class="token punctuation">;</span>    <span class="token function">dhd</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">hd</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">hd</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>tt<span class="token punctuation">;</span>    <span class="token function">ddhd</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">dhd</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">dhd</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>tt<span class="token punctuation">;</span>    <span class="token function">hr</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">ddhd</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">-</span> lamb<span class="token operator">*</span>dhv<span class="token punctuation">;</span>    hv <span class="token operator">=</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">hd</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    dhv <span class="token operator">=</span> <span class="token function">dh</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">dhd</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">s</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> dhv <span class="token operator">+</span> lamb<span class="token operator">*</span>hv<span class="token punctuation">;</span>    <span class="token function">ae</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">ae</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> alpha_a<span class="token operator">*</span><span class="token function">s</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">hr</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">be</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">be</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> alpha_b<span class="token operator">*</span><span class="token function">s</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">dh</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">ce</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">ce</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> alpha_c<span class="token operator">*</span><span class="token function">s</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token operator">*</span>g<span class="token punctuation">;</span>    <span class="token function">ufn</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">ae</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">hr</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">-</span> k<span class="token operator">*</span><span class="token function">s</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">be</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">dh</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ce</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token operator">*</span>g<span class="token punctuation">;</span>    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">ufn</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">else</span>        <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span> miu<span class="token operator">*</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">-</span> sigma<span class="token operator">*</span><span class="token function">dh</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">end</span>    <span class="token function">ddh</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span> <span class="token operator">=</span>  <span class="token function">f</span><span class="token punctuation">(</span><span class="token number">i</span><span class="token punctuation">)</span><span class="token operator">/</span>m <span class="token operator">-</span> g<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token comment" spellcheck="true">% 绘图</span><span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token function">plot</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> hd<span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>hold on<span class="token punctuation">;</span><span class="token function">plot</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">set</span><span class="token punctuation">(</span>gca<span class="token punctuation">,</span><span class="token string">'YLim'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1.1</span><span class="token operator">*</span><span class="token function">min</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">'运动路径'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">xlabel</span><span class="token punctuation">(</span><span class="token string">'t/s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ylabel</span><span class="token punctuation">(</span><span class="token string">'h/m'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">legend</span><span class="token punctuation">(</span><span class="token string">'Ref'</span><span class="token punctuation">,</span> <span class="token string">'Real'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token function">plot</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>hold on<span class="token punctuation">;</span><span class="token function">plot</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">'加持力&amp;摩擦力'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">xlabel</span><span class="token punctuation">(</span><span class="token string">'t/s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ylabel</span><span class="token punctuation">(</span><span class="token string">'f/N'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">legend</span><span class="token punctuation">(</span><span class="token string">'f_n'</span><span class="token punctuation">,</span><span class="token string">'f'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token function">plot</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> dh<span class="token punctuation">)</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">'运动速度'</span><span class="token punctuation">)</span><span class="token function">xlabel</span><span class="token punctuation">(</span><span class="token string">'t/s'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ylabel</span><span class="token punctuation">(</span><span class="token string">'v/m\cdots^&amp;#123;-1&amp;#125;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行程序，观察生成的图像(如下图所示)，基本符合实际运动规律，可以认为控制模型合理。<br><img src="http://q789z4z6g.bkt.clouddn.com/sim2.svg?center" alt="程序模拟的运动曲线"></p><h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><div id="ref-anchor"></div><p>[1].  Francisco, E. Vina B. , et al. “Adaptive control for pivoting with visual and tactile feedback.” 2016 IEEE International Conference on Robotics and Automation (ICRA) IEEE, 2016. <br><br>[2]. J.Slotine and W.Li, “Applied Nonlinear Control.” Prentice Hall, 1991. <br></p>]]></content>
      
      
      <categories>
          
          <category> 术业专攻 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Matlab </tag>
            
            <tag> Robot-hand </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>整理Git仓库</title>
      <link href="2020/03/02/Clean-up-git-repository/"/>
      <url>2020/03/02/Clean-up-git-repository/</url>
      
        <content type="html"><![CDATA[<blockquote><p>重新整理博客的Git仓库。把主题分离成一个新的仓库，主题和博客分别更新。</p></blockquote><a id="more"></a><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>为了能更好的管理博客和主题仓库，我觉得还是分成两个Git仓库比较合适。本篇博客主要讲述如何从仓库中分离一个新仓库，同时在两个仓库中只保留与本仓库有关的commit。为了讲述方便，现做如下定义：</p><ul><li>旧仓库路径: <code>&lt;pre-repo&gt;</code>;</li><li>需要分离出的子文件夹名称: <code>&lt;folder&gt;</code>;</li><li>建立的新仓库: <code>&lt;new-repo&gt;</code>;</li></ul><h2 id="分离themes仓库"><a href="#分离themes仓库" class="headerlink" title="分离themes仓库"></a>分离themes仓库</h2><p>分离仓库有两种方法：简单的是使用<code>git subtree</code>，麻烦点的是使用<code>git filter-branch</code>。</p><h3 id="Git-subtree"><a href="#Git-subtree" class="headerlink" title="Git subtree"></a>Git subtree</h3><p>自从 1.8 版本之后 git 就添加了 subtree 子命令，使用这个新命令我们可以很简单高效地解决这个问题。首先进入<code>&lt;pre-repo&gt;</code>，运行：</p><pre class="line-numbers language-git"><code class="language-git">git subtree split -P &lt;folder> -b &lt;temp-branch><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其中<code>&lt;temp-branch&gt;</code>是一个临时分支。运行后，git会遍历原仓库中所有的历史提交，筛选出与指定路径有关的commit并存入<code>&lt;temp-branch&gt;</code>。然后就简单了，只需要在别的文件夹pull这个临时分支，就能将子仓库clone过去。运行：</p><pre class="line-numbers language-shell-session"><code class="language-shell-session">mkdir <new-repo>cd <new-repo>git initgit pull <pre-repo> <temp-branch><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Git-filter-branch"><a href="#Git-filter-branch" class="headerlink" title="Git filter-branch"></a>Git filter-branch</h3><p>这是一个git传统的核弹级大杀器，慎用。首先，clone一份原仓库并删掉其remote：</p><pre class="line-numbers language-git"><code class="language-git">git clone &lt;pre-repo> &lt;new-repo>cd &lt;newo-repo>git remote rm origin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>然后运行如下命令，遍历所有历史提交，只保留对指定子目录有影响的提交，并将该子目录设为仓库的根目录：</p><pre class="line-numbers language-git"><code class="language-git">git filter-branch --tag-name-filter cat --prune-empty --subdirectory-filter &lt;folder> -- --all<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其中各参数的作用为：</p><ul><li><code>--tag-name-filter</code>: 控制如何处理旧的tag，cat表示原样输出；</li><li><code>--prune-empty</code>: 删除因为重写导致空了的commit，比如修改的文件全部被删除；</li><li><code>--subdirectory-filter</code>: 指定子目录路径；</li><li><code>-- -- all</code>: 对所有分支进行操作，当然如果你只想保留当前分支，也可以不加此参数。</li></ul><p>该命令执行完成后，可以看到新仓库中已经变成原来子仓库的内容，也只保留了相关的提交历史。不过这时新仓库中的<code>.git</code>目录中还是保留了不少无用的object，我们需要将其清除以减小新仓库的体积（方法一则不需要执行这一步）。运行如下命令：</p><pre class="line-numbers language-git"><code class="language-git">git reset --hardgit for-each-ref --format=<span class="token string">"%(refname)"</span> refs/original/ | xargs -n 1 git update-ref -dgit reflog expire --expire=now --allgit gc --aggressive --prune=now<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="关联原仓库与新仓库"><a href="#关联原仓库与新仓库" class="headerlink" title="关联原仓库与新仓库"></a>关联原仓库与新仓库</h3><p>这一步是可选的。一般来说，在我们把原目录中的子文件夹分离成独立的 git 仓库后，总会希望再通过某种方法在原仓库中引用新仓库的代码。这里我们可以通过<code>subtree</code>或<code>submodule</code>两种方法来实现，不过各有优缺点，可以视情况选择，不过现在一般都推荐使用subtree。当然，你也可以分离之后直接使用 npm、composer 之类的包管理器将新仓库作为一个依赖库引入进来，这也是完全没有问题的。</p><h2 id="清理旧仓库"><a href="#清理旧仓库" class="headerlink" title="清理旧仓库"></a>清理旧仓库</h2><p>既然将子目录分离成了新仓库，那么或许你还想要将子目录从原仓库的<code>.git</code>中删除。在原仓库路径下运行如下命令：</p><pre class="line-numbers language-git"><code class="language-git">git filter-branch --force --prune-empty --index-filter <span class="token string">'git rm -rf --cached --ignore-unmatch &lt;folder>'</span> --tag-name-filter cat -- --all<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>其中各参数的作用为：</p><ul><li><code>--force</code>: 让git即使遇到冲突也强制执行；</li><li><code>--index-filter</code>: 指定重写的时候执行的命令，要执行的命令紧跟其后；</li><li><code>git rm -rf --cached --ignore-unmatch &lt;folder&gt;</code>: 让git删除匹配到的缓存文件。</li></ul><p>执行完成后，本地仓库已经删除了子目录及其相关的提交历史。最后提交到远程即可：</p><pre class="line-numbers language-git"><code class="language-git">git push --force --all<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ol><li><a href="http://varyu.com/notes/527.html">如何将现有 git 仓库中的子目录分离为独立仓库并保留其提交历史 <strong>By</strong> 瑜小瑜</a></li><li><a href="https://www.jianshu.com/p/780161d32c8e">彻底删除git中没用的大文件 <strong>By</strong> Phelthas</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>修改主题--Yelee</title>
      <link href="2020/02/29/Custom-yelee/"/>
      <url>2020/02/29/Custom-yelee/</url>
      
        <content type="html"><![CDATA[<blockquote><p>对Hexo主题Yelee进行的一些修改。修复一些显示bug，添加新功能，对部分功能进行优化。</p></blockquote><a id="more"></a><h3 id="移动端菜单栏显示问题"><a href="#移动端菜单栏显示问题" class="headerlink" title="移动端菜单栏显示问题"></a>移动端菜单栏显示问题</h3><p><strong>目标文件</strong> /source/css/_partial/main.styl。第二行，去掉container设置中<code>position: relative</code>前的注释符。此时，移动端菜单栏显示正常，但是在pc和移动端都会会出现右栏不能铺满屏幕的问题。继续更改css文件可以解决。</p><p><strong>目标文件</strong> /source/css/style.styl。找到下面的代码段，在<code>html</code>和<code>body</code>中添加尺寸设置，修改为：</p><pre class="line-numbers language-git"><code class="language-git">html  font-size base-font-size<span class="token inserted">+ height: 100%;</span><span class="token inserted">+ min-height: 100%;</span><span class="token inserted">+ min-width: 300px;</span>body<span class="token inserted">+ height: 100%;</span><span class="token inserted">+ min-height: 100%;</span>  font-family: font-sans, font-chs, sans-serif;  background: #fff;  text-rendering: optimizeLegibility;  -moz-osx-font-smoothing: grayscale;  -moz-font-feature-settings: <span class="token string">"liga"</span> on;  color: #333  -webkit-overflow-scrolling: touch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="代码块前后留白问题"><a href="#代码块前后留白问题" class="headerlink" title="代码块前后留白问题"></a>代码块前后留白问题</h3><p>代码块中空行消失，导致显示出错，在issue上已经有人解决了。<strong>目标文件：</strong> source/css/_partial/highlight.sytl。修改为：</p><pre class="line-numbers language-git"><code class="language-git">  pre, code    font-fanmily: font-mono, monospace, font-chs    font-size: 1em<span class="token inserted">+ .line:after</span><span class="token inserted">+   content: ''</span><span class="token inserted">+   display: inline-block;</span>  pre    @extend $code-block    code<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="取消用新标签页面打开搜索结果"><a href="#取消用新标签页面打开搜索结果" class="headerlink" title="取消用新标签页面打开搜索结果"></a>取消用新标签页面打开搜索结果</h3><p><strong>目标文件：</strong> themes/yelee/source/js/search.js。找到下面代码段</p><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// show search results</span><span class="token keyword">if</span> <span class="token punctuation">(</span>isMatch<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span>    str <span class="token operator">+=</span> <span class="token string">"&lt;li>&lt;a href='"</span><span class="token operator">+</span> data_url <span class="token operator">+</span><span class="token string">"' class='search-result-title' target='_blank'>"</span><span class="token operator">+</span> <span class="token string">"> "</span> <span class="token operator">+</span> data_title <span class="token operator">+</span><span class="token string">"&lt;/a>"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>删除<code>target=&#39;_blank&#39;</code>字段</p><h3 id="取消迷你文章在新窗口打开"><a href="#取消迷你文章在新窗口打开" class="headerlink" title="取消迷你文章在新窗口打开"></a>取消迷你文章在新窗口打开</h3><p><strong>目标文件：</strong> themes/yelee/layout/_partial/open-in-new-tab.ejs。找到</p><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>open_in_new<span class="token punctuation">.</span>mini_archives<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">></span> miniArchives<span class="token operator">:</span> <span class="token string">"a.post-list-link"</span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>因为在_config.yml中设置mini_archives好像不起作用，所以将<code>theme.open_in_new.mini_archives</code>直接设为false即可。</p><h3 id="添加文章字数统计"><a href="#添加文章字数统计" class="headerlink" title="添加文章字数统计"></a>添加文章字数统计</h3><p>这个功能需要用到插件：<code>hexo-wordcount</code>，在Hexo项目根目录下使用命令<code>npm i --save hexo-wordount</code>进行安装。下面的配置是信息显示位置和样式，仅供参考。</p><p><strong>目标文件：</strong> themes/yelee/layout/_partial/post/tag.ejs。做如下修改：</p><pre class="line-numbers language-git"><code class="language-git">&lt;% if (post.tags &amp;&amp; post.tags.length)&amp;#123; %><span class="token deleted">-    &lt;div class="article-tag tagcloud"></span><span class="token inserted">+    &lt;div class="article-tag tagcloud" style="display: flex; flex-wrap: wrap"></span>        &lt;%-          list_tags(post.tags, &amp;#123;            show_count: false,            class: <span class="token string">'article-tag'</span>          &amp;#125;)        %><span class="token inserted">+       &lt;span class="post-count">总字数&lt;%= wordcount(post.content) %>&lt;/span></span><span class="token inserted">+       &lt;span class="post-count">预计阅读&lt;%= min2read(post.content) %>分钟&lt;/span></span>    &lt;/div>&lt;% &amp;#125; %><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>添加样式：<br><strong>目标文件</strong> themes/yelee/source/css/_partial/tagcloud.styl。找到</p><pre class="line-numbers language-css-extras"><code class="language-css-extras">.article-tag::before,.article-category::before    float left    color #999    font base-font-size FontAwesome    margin-right 5px    margin-top (1/3)rem.article-tag::before    content "\f02b"    margin-left 1em.article-category::before    content "\f02d"<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在<code>.article-category::before</code>前插入以下代码</p><pre class="line-numbers language-css-extras"><code class="language-css-extras">.article-tag    .article-tag-list        display flex        flex-wrap wrap    span        cursor pointer        line-height 29px        font-size 13px        color #aaa        &:before            content "\27A4"            margin-left 1em<Paste><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中，<code>content: &quot;\27A4&quot;</code>是unicode图标编码，根据自己需求替换。</p><p><a href="https://unicode-table.com/cn">unicode图标</a></p><p><a href="https://fontawesome.com/icons?from=io">Font Awesome icom</a></p><h3 id="添加多合一打赏"><a href="#添加多合一打赏" class="headerlink" title="添加多合一打赏"></a>添加多合一打赏</h3><p>实现原理见博文, <a href="https://mkblog.cn/922/">多合一收款二维码原理及实现(源码)</a>。具体操作为，在yelee的配置文件<br><code>_config.yml</code>中加上：</p><pre class="line-numbers language-yml"><code class="language-yml"># 打赏# 将 on 改为 false 去掉打赏donate:  on: true  multipay: /img/multipay.png<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>multipay.png上的二维码指向链接/pages/donate，然后根据用户的userAgent转向不同服务。</p><p><strong>目标文件</strong> themes/yelee/layout/_partial/left-col.ejs。找到</p><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">&lt;</span>nav <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"header-nav"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>ul <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"social"</span><span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">for</span> <span class="token punctuation">(</span>var i in theme<span class="token punctuation">.</span>subnav<span class="token punctuation">)</span><span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">></span>            <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"fa &lt;%= i %>"</span> href<span class="token operator">=</span><span class="token string">"&lt;%- url_for(theme.subnav[i]) %>"</span> title<span class="token operator">=</span><span class="token string">"&lt;%= i %>"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span><span class="token operator">%</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>nav<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在<code>&lt;/ul&gt;</code>下添加</p><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>donate<span class="token punctuation">.</span>on<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">></span>    <span class="token operator">&lt;</span>ul <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"social"</span><span class="token operator">></span>        <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token string">"position: absolute; top: 95%; left: 50%; margin-left: -30px;"</span><span class="token operator">></span>            <span class="token operator">&lt;</span>p style<span class="token operator">=</span><span class="token string">"display: block"</span><span class="token operator">></span>                <span class="token operator">&lt;</span>a                    <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"donateIcon"</span>                    href<span class="token operator">=</span><span class="token string">"javascript:void(0)"</span>                    onmouseout<span class="token operator">=</span>"                        var qr <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'donate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        qr<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">;</span>                    "                    onmouseenter<span class="token operator">=</span>"                        var qr <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'donate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        qr<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display<span class="token operator">=</span><span class="token string">'block'</span><span class="token punctuation">;</span>                    "<span class="token operator">></span>                    赏                <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>            <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在<code>left-col.ejs</code>文件末尾添加：</p><pre class="line-numbers language-java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>theme<span class="token punctuation">.</span>donate<span class="token punctuation">.</span>multipay<span class="token punctuation">)</span> <span class="token operator">&amp;</span>#<span class="token number">123</span><span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">></span>    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"donate"</span><span class="token operator">></span>        <span class="token operator">&lt;</span>img id<span class="token operator">=</span><span class="token string">"multipay"</span> src<span class="token operator">=</span><span class="token string">"&lt;%=theme.donate.multipay%>"</span> width<span class="token operator">=</span><span class="token string">"250px"</span> alt<span class="token operator">=</span><span class="token string">"&lt;%=theme.author%> Multipay"</span><span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"triangle"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">%</span> <span class="token operator">&amp;</span>#<span class="token number">125</span><span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span>Paste<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>目标文件：</strong> themes/yelee/source/css/_partial/customise/social-icon.styl。在顶部找到</p><pre class="line-numbers language-css-extras"><code class="language-css-extras">#header .header-nav .social    margin-top 10px    text-align center    font-family Arial    a        width base-font-size + 21        height @width        border-radius 50%        margin 0 2px 6px        vertical-align middle        font-size .66*@width        line-height @width        text-align center        color white        background #6f7170        opacity i-opacity        box-shadow 1px 2px 2px rgba(0,0,0, .1), 1px 1px 3px rgba(0,0,0, .3)        &:hover            opacity 1            transform scale(1.1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在<code>a</code>标签的样式后添加</p><pre class="line-numbers language-css-extras"><code class="language-css-extras">.donateIcon    display block    width 56px    margin auto    height 56px    font-size 20px    color #fff    border none    background #4094c7    border-radius 50%    text-align center    -webkit-box-shadow 0 2px 5px 0 rgba(0,0,0,0,16), 0 2px 10px 0 rgba(0,0,0,0,12)    box-shadow 0 2px 5px 0 rgba(0,0,0,0,16), 0 2px 10px 0 rgba(0,0,0,0,12)    -webkit-transition 0.4s ease-in-out    -moz-transition 0.4s ease-in-out    -ms-transition 0.4s ease-in-out    transition 0.4s ease-in-out<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>目标文件：</strong> themes/yelee/source/css/_partial/main.styl。找到<code>intrude-less</code>并加上donate标签的样式。</p><pre class="line-numbers language-git"><code class="language-git">.intrude-less &amp;#123;    width: 76%;    text-align: center;    margin: 112px auto 0;<span class="token inserted">+   #donate &amp;#123;</span><span class="token inserted">+       display: none;</span><span class="token inserted">+       position: fixed;</span><span class="token inserted">+       top: 280px;</span><span class="token inserted">+       left: 25px;</span><span class="token inserted">+       img &amp;#123;</span><span class="token inserted">+           border-radius: 5px;</span><span class="token inserted">+       &amp;#125;</span><span class="token inserted">+       .triangle &amp;#123;</span><span class="token inserted">+           height: 0;</span><span class="token inserted">+           width: 0;</span><span class="token inserted">+           margin: -5px 0 0 85px;</span><span class="token inserted">+           border-right: 45px solid transparent;</span><span class="token inserted">+           border-left: 45px solid transparent;</span><span class="token inserted">+           border-top: 30px solid #5b91ee;</span><span class="token inserted">+       &amp;#125;</span><span class="token inserted">+   &amp;#125;</span>&amp;#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="修改列表显示的bug"><a href="#修改列表显示的bug" class="headerlink" title="修改列表显示的bug"></a>修改列表显示的bug</h3><p>markdown文件中无序列表显示有误，比如 “- [列表名]”, 如果列表名前两个字符含 ‘x’, 则列表前缀消失。排查之后发现是 main.js 里对无序列表进行了判断，若出现 “- [ ]” 或者 “- [x]”，则解析成复选框的样式，需要修改判断条件。</p><p><strong>目标文件：</strong> themes/yelee/source/js/main.js</p><pre class="line-numbers language-git"><code class="language-git">// Task lists in markdown$(<span class="token string">'ul > li'</span>).each(function() &amp;#123;    var taskList = &amp;#123;<span class="token deleted">-       field: this.textContent.substring(0, 2),</span><span class="token inserted">+       field: this.textContent.substring(0, 3),</span>        check: function(str) &amp;#123;<span class="token deleted">-           var re = new RegExp(str);</span><span class="token deleted">-           return this.field.match(re);</span><span class="token inserted">+           return this.field === str;</span>        &amp;#125;    &amp;#125;    ...&amp;#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="添加谷歌站长并提交站点地图"><a href="#添加谷歌站长并提交站点地图" class="headerlink" title="添加谷歌站长并提交站点地图"></a>添加谷歌站长并提交站点地图</h3><p>验证网站：<a href="https://www.google.com/webmasters/tools/">Search Console</a>。然后安装sitemap生成器，<code>npm install hexo-generator-sitemap --save</code>，在站点配置文件<code>_config.yml</code>中加上</p><pre class="line-numbers language-yml"><code class="language-yml">### sitemapsitemap:  path: sitemap.xml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>再部署一遍后，博客目录下会多出一个<code>sitemap.xml</code>文件，到谷歌站长里添加地图即可。</p><p>值得注意的是，搜索引擎会抓取路径在三级以内的地址，如果路径太多可能抓取不到，但 hexo 文章的路径默认会加上日期，比如<code>http://wangriyu.wang/2017/08/24/Hexo/</code>。在站点配置文件中修改一下permalink（默认是:year/:month/:day/:title/），这样就不会在加上日期了：</p><pre class="line-numbers language-yml"><code class="language-yml"># URL## If your site is put in a subdirectory, set url as 'http://yoursite.com/child' and root as '/child/'url: http://wangriyu.wangroot: /permalink: :title.htmlpermalink_defaults:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="使用七牛云图床"><a href="#使用七牛云图床" class="headerlink" title="使用七牛云图床"></a>使用七牛云图床</h3><p>注册<a href="https://sso.qiniu.com/">七牛云</a>账号，七牛云可以用来生成外链来代替站内的图片资源。详情略过。</p><h3 id="添加隐藏侧边栏的按钮"><a href="#添加隐藏侧边栏的按钮" class="headerlink" title="添加隐藏侧边栏的按钮"></a>添加隐藏侧边栏的按钮</h3><p><strong>目标文件：</strong> themes/yelee/layout/layout.ejs</p><pre class="line-numbers language-git"><code class="language-git">    ...<span class="token inserted">+   &lt;div class="hide-left-col" title="隐藏侧栏"></span><span class="token inserted">+     &lt;i class="fa fa-angle-double-left">&lt;/i></span><span class="token inserted">+   &lt;/div></span>    &lt;div class=<span class="token string">"mid-col"</span>>      &lt;%- partial(<span class="token string">'_partial/mobile-nav'</span>, null, &amp;#123;cache: !config.relative_link&amp;#125;) %>      &lt;div class=<span class="token string">"body-wrap"</span>>&lt;%- body %>&lt;/div>      &lt;%- partial(<span class="token string">'_partial/footer'</span>) %>    &lt;/div><span class="token inserted">+   &lt;script type="application/javascript"></span><span class="token inserted">+     var hide = false, leftWidth = &lt;%- theme.left_col_width %>;</span><span class="token inserted">+     function hideLeftCol() &amp;#123;</span><span class="token inserted">+       if (hide) &amp;#123;</span><span class="token inserted">+         $(".left-col").width(leftWidth);</span><span class="token inserted">+         $(".left-col .intrude-less").css('display', '');</span><span class="token inserted">+         $("#tocButton").css('display', '');</span><span class="token inserted">+         ($('#switch-btn').css('display') === 'block' &amp;&amp; $('#switch-area').css('display') === 'block') || $('#toc').slideDown(320);</span><span class="token inserted">+         $(".hide-left-col").css("left", leftWidth).html('&lt;i class="fa fa-angle-double-left">&lt;/i>');</span><span class="token inserted">+         $(".mid-col").css("left", leftWidth)</span><span class="token inserted">+         $("#post-nav-button").css("left", leftWidth)</span><span class="token inserted">+         $("#post-nav-button > a:nth-child(2)").css("display", "block")</span><span class="token inserted">+         hide = false</span><span class="token inserted">+       &amp;#125; else &amp;#123;</span><span class="token inserted">+         $(".left-col").width(0);</span><span class="token inserted">+         $(".left-col .intrude-less").css('display', 'none');</span><span class="token inserted">+         $("#toc").css('display', 'none');</span><span class="token inserted">+         $("#tocButton").css('display', 'none');</span><span class="token inserted">+         $(".hide-left-col").css("left", 0).html('&lt;i class="fa fa-angle-double-right">&lt;/i>');</span><span class="token inserted">+         $(".mid-col").css("left", 0)</span><span class="token inserted">+         $("#post-nav-button").css("left", 0)</span><span class="token inserted">+         $("#post-nav-button > a:nth-child(2)").css("display", "none")</span><span class="token inserted">+         if ($(".post-list").is(":visible")) &amp;#123;</span><span class="token inserted">+           $("#post-nav-button .fa-bars,#post-nav-button .fa-times").toggle();</span><span class="token inserted">+           $(".post-list").toggle();</span><span class="token inserted">+         &amp;#125;</span><span class="token inserted">+         hide = true</span><span class="token inserted">+       &amp;#125;</span><span class="token inserted">+     &amp;#125;</span><span class="token inserted">+     $(".hide-left-col").click(function() &amp;#123;</span><span class="token inserted">+       hideLeftCol()</span><span class="token inserted">+     &amp;#125;);</span><span class="token inserted">+   &lt;/script></span>    &lt;%- partial(<span class="token string">'_partial/after-footer'</span>) %>  &lt;/div><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>目标文件：</strong> themes/yelee/source/css/_partial/main.styl。</p><pre class="line-numbers language-git"><code class="language-git">.left-col &amp;#123;  ...&amp;#125;<span class="token inserted">+.hide-left-col &amp;#123;</span><span class="token inserted">+   z-index: 999;</span><span class="token inserted">+   cursor: pointer;</span><span class="token inserted">+   transition:all .2s ease-in;</span><span class="token inserted">+   position: fixed;</span><span class="token inserted">+   top: 0;</span><span class="token inserted">+   left: left-col-width;</span><span class="token inserted">+   text-align: center;</span><span class="token inserted">+   line-height: 30px;</span><span class="token inserted">+   display: block;</span><span class="token inserted">+   width: 30px;</span><span class="token inserted">+   height: 30px;</span><span class="token inserted">+   font-size: 28px;</span><span class="token inserted">+   background: none;</span><span class="token inserted">+   .fa &amp;#123;</span><span class="token inserted">+       color: rgb(255, 255, 255, .5);</span><span class="token inserted">+   &amp;#125;</span><span class="token inserted">+   &amp;:hover &amp;#123;</span><span class="token inserted">+       background: rgba(147, 181, 224, .3) !important;</span><span class="token inserted">+       .fa &amp;#123;</span><span class="token inserted">+           color: white;</span><span class="token inserted">+       &amp;#125;</span><span class="token inserted">+   &amp;#125;</span><span class="token inserted">+&amp;#125;</span>.mid-col &amp;#123;  ...&amp;#125;...@media screen and (max-width:768px) &amp;#123;<span class="token inserted">+   .hide-left-col &amp;#123;</span><span class="token inserted">+       display: none;</span><span class="token inserted">+   &amp;#125;</span>    @import <span class="token string">"_partial/mobile"</span>&amp;#125;...<span class="token comment" spellcheck="true">#post-nav-button &amp;#123;</span>    left: left-col-width;    top: 61.8%;<span class="token inserted">+   transition: left .2s ease-in;</span>    a &amp;#123;        border-bottom-color: transparent;        background: none;        cursor: pointer;        .fa-times &amp;#123;            display: none;        &amp;#125;    &amp;#125;&amp;#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>目标文件：</strong> themes/yelee/source/css/_partial/mobile.styl。</p><pre class="line-numbers language-git"><code class="language-git">.left-col &amp;#123;<span class="token deleted">-   display: none;</span><span class="token inserted">+   display: none !important;</span>&amp;#125;.mid-col &amp;#123;<span class="token deleted">-   left: 0;</span><span class="token inserted">+   left: 0 !important;</span>&amp;#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="使用prism代码高亮"><a href="#使用prism代码高亮" class="headerlink" title="使用prism代码高亮"></a>使用prism代码高亮</h3><p>安装插件<code> npm i -S hexo-prism-plugin</code>。将根目录<code>_config.yml</code>中的highlight部分均设为false，并添加prism配置项：</p><pre class="line-numbers language-git"><code class="language-git">highlight:<span class="token deleted">- enable: true</span><span class="token inserted">+ enable: false</span>  line_number: false  auto_detect: false  tab_replace:<span class="token comment" spellcheck="true"># prism</span><span class="token comment" spellcheck="true"># https://prismjs.com/#languages-list</span><span class="token inserted">+ prism_plugin:</span><span class="token inserted">+   mode: 'preprocess'   # realtime/preprocess</span><span class="token inserted">+   theme: 'a11y-dark'   # https://github.com/PrismJS/prism-themes#available-themes</span><span class="token inserted">+   line_number: true    # default false</span><span class="token inserted">+   custom_css:          # optional</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将主题的<code>_config.yml</code>的highlight_style删掉。</p><pre class="line-numbers language-git"><code class="language-git"><span class="token deleted">-highlight_style:</span><span class="token deleted">-  on: false</span><span class="token deleted">-  inline_code: 3  # Value: 0 - 9 可选</span><span class="token deleted">-  code_block: 4  # Value: 0 - 4</span><span class="token deleted">-  # Set inline_code to style highlight text</span><span class="token deleted">-  # Chose a highlight theme for code block</span><span class="token deleted">-  # 通过 inline_code 切换内置文本高亮样式</span><span class="token deleted">-  # 通过 code_block 切换内置代码高亮配色主题</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>删除 themes/yelee/source/css/_partial/customise/ 下的 code-block.styl 和 inline-code.styl。删除 themes/yelee/source/css/_partial/highlight.styl</p><p>修改mobile.styl:</p><pre class="line-numbers language-git"><code class="language-git">    .article-entry&amp;#123;        padding-left: 0;        padding-right: 0;<span class="token deleted">-       .highlight &amp;#123;</span><span class="token deleted">-           padding .35em .6em</span><span class="token deleted">-       &amp;#125;</span>    &amp;#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>修改themes/yelee/source/css/style.styl:</p><pre class="line-numbers language-git"><code class="language-git">@import <span class="token string">"_partial/archive"</span>@import <span class="token string">"_partial/article"</span>@import <span class="token string">"_partial/archive"</span><span class="token deleted">- @import "_partial/highlight"</span>@import <span class="token string">"_partial/footer"</span>if share@ -117,4 +116,14 @@ if search@import <span class="token string">"_partial/customise/color-scheme"</span>if sidebar  @import <span class="token string">"_partial/sidebar"</span>  @import <span class="token string">"_partial/sidebar"</span><span class="token inserted">+ .article-entry code</span><span class="token inserted">+   color gray</span><span class="token inserted">+   padding .05em .3em</span><span class="token inserted">+   border-radius 3px</span><span class="token inserted">+   box-shadow 1px 1px 1px rgba(0,0,0, .08)</span><span class="token inserted">+   background rgba(255, 250, 165, .7)</span><span class="token inserted">+ .article-entry pre code</span><span class="token inserted">+   padding 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意使用此插件时所有代码块都需要指定语言，否则无法加载高亮效果。<a href="https://prismjs.com/#languages-list">语言列表</a></p><h3 id="升级fancybox图片浏览插件"><a href="#升级fancybox图片浏览插件" class="headerlink" title="升级fancybox图片浏览插件"></a>升级fancybox图片浏览插件</h3><p>修改主题的<code>_config.yml</code>中的CDN：</p><pre class="line-numbers language-git"><code class="language-git"><span class="token deleted">-  fancybox_js: //cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js</span><span class="token deleted">-  fancybox_css: //cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css</span><span class="token inserted">+  fancybox_js: //cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js</span><span class="token inserted">+  fancybox_css: //cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>修改themes/yelee/source/js/main.js:</p><pre class="line-numbers language-git"><code class="language-git">// fancyBoxif(!!yiliaConfig.fancybox)&amp;#123;    require([yiliaConfig.fancybox_js], function(pc)&amp;#123;        var isFancy = $(<span class="token string">".isFancy"</span>);        if(isFancy.length != 0)&amp;#123;            var imgArr = $(<span class="token string">".article-inner img"</span>);            for(var i=0,len=imgArr.length;i&lt;len;i++)&amp;#123;                var src = imgArr.eq(i).attr(<span class="token string">"src"</span>);                var title = imgArr.eq(i).attr(<span class="token string">"alt"</span>);                if(typeof(title) == <span class="token string">"undefined"</span>)&amp;#123;                    var title = imgArr.eq(i).attr(<span class="token string">"title"</span>);                &amp;#125;                var width = imgArr.eq(i).attr(<span class="token string">"width"</span>);                var height = imgArr.eq(i).attr(<span class="token string">"height"</span>);<span class="token deleted">-               imgArr.eq(i).replaceWith("&lt;a href='"+src+"' title='"+title+"' rel='fancy-group' class='fancy-ctn fancybox'>&lt;img src='"+src+"' width="+width+" height="+height+" title='"+title+"' alt='"+title+"'>&lt;/a>");</span><span class="token inserted">+               imgArr.eq(i).replaceWith("&lt;a class='fancy-ctn' href='"+src+"' title='"+title+"' data-fancybox='images' data-caption='"+src.substring(src.lastIndexOf("/")+1)+"'>&lt;img src='"+src+"' width="+width+" height="+height+" title='"+title+"' alt='"+title+"'>&lt;/a>");</span>            &amp;#125;<span class="token deleted">-           $(".article-inner .fancy-ctn").fancybox(&amp;#123; type: "image" &amp;#125;);</span><span class="token inserted">+           $(".article-inner .fancy-ctn").fancybox(&amp;#123;</span><span class="token inserted">+             loop: true,</span><span class="token inserted">+             touch: false,</span><span class="token inserted">+             toolbar: true,</span><span class="token inserted">+             wheel: false,</span><span class="token inserted">+             buttons: [</span><span class="token inserted">+               "fullScreen",</span><span class="token inserted">+               "thumbs",</span><span class="token inserted">+               "close"</span><span class="token inserted">+             ],</span><span class="token inserted">+           &amp;#125;);</span>        &amp;#125;    &amp;#125;)&amp;#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>修改themes/yelee/source/css/style.styl，在最后面插入：</p><pre class="line-numbers language-js"><code class="language-js"><span class="token punctuation">.</span>fancybox<span class="token operator">-</span>image  background #ffffff<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><hr><ol><li><a href="http://moxfive.coding.me/yelee/">Yelee主题使用说明, <strong>By</strong> MOxFIVE</a></li><li><a href="https://blog.wangriyu.wang/2017/08-Hexo.html">使用Hexo主题Yelee, <strong>By</strong> 鱼の乐</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 博客之路 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Yelee </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="2020/02/27/hello-world/"/>
      <url>2020/02/27/hello-world/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p></blockquote><a id="more"></a><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
      
      
      <categories>
          
          <category> 博客之路 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
